# Visual Flow Diagram: Smart Eligibility Check

## Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER CLICKS "TEST ELIGIBILITY"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Is logged in?â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ NO              â”‚ YES             â”‚
         â–¼                 â–¼                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚  SHOW LOGIN â”‚   â”‚ CHECK TOKEN  â”‚      â”‚
    â”‚   SCREEN    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚             â”‚          â”‚              â”‚
    â”‚  (phone/    â”‚          â–¼              â”‚
    â”‚   email)    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   API CALL:      â”‚   â”‚
         â”‚           â”‚   GET /auth/me   â”‚   â”‚
         â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚                  â”‚               â”‚
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
         â”‚         â”‚ API RESPONSE    â”‚      â”‚
         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
         â”‚                  â”‚               â”‚
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
         â”‚         â”‚  GET ARRAY:     â”‚      â”‚
         â”‚         â”‚ eligibilities[] â”‚      â”‚
         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
         â”‚                  â”‚               â”‚
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         â”‚ LENGTH > 0?           â”‚
         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚ NO   â”‚ YES
         â”‚                  â–¼      â–¼
         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚QUIZ  â”‚ â”‚ VOICE AGENT       â”‚
         â”‚            â”‚      â”‚ â”‚ (SKIP QUIZ!) âœ¨   â”‚
         â”‚            â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚          â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚    â–¼                      â–¼
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  â”‚ ELIGIBILITY        â”‚  â”‚ VOICE AGENT (VAPI)   â”‚
         â”‚  â”‚ QUESTIONNAIRE      â”‚  â”‚ - Professional lawyerâ”‚
         â”‚  â”‚ (6-STEP WIZARD)    â”‚  â”‚ - Real-time audio   â”‚
         â”‚  â”‚                    â”‚  â”‚ - Transcript chat   â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - Volume meter      â”‚
         â”‚           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚    â”‚ COMPLETE ALL             â”‚     â”‚
         â”‚    â”‚ ELIGIBILITY ANSWERS      â”‚     â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚           â”‚                          â”‚
         â”‚           â–¼                          â–¼
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚ VOICE AGENT (VAPI) â”‚  â”‚ COMPLETE CALL    â”‚
         â”‚    â”‚ (Now start)         â”‚  â”‚ - Analysis done  â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚                       â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚    â”‚
         â”‚    â–¼
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ â”‚ CALL COMPLETED      â”‚
         â”‚ â”‚ - Transcript saved  â”‚
         â”‚ â”‚ - Data extracted    â”‚
         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚DASHBOARD â”‚  â”‚DASHBOARD    â”‚
              â”‚(signed up)   â”‚(existing)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Decision Tree

```
START: User clicks "Test Eligibility"
â”‚
â”œâ”€ Is user logged in?
â”‚  â”‚
â”‚  â”œâ”€ NO â”€â”€â”€â”€â”€â”€â–º SHOW LOGIN SCREEN
â”‚  â”‚             â”‚
â”‚  â”‚             â””â”€â”€â–º User logs in â”€â”€â–º (Loop back to CHECK API)
â”‚  â”‚
â”‚  â””â”€ YES â”€â”€â”€â”€â”€â–º CHECK API: /auth/me
â”‚                â”‚
â”‚                â”œâ”€ API ERROR â”€â”€â”€â”€â”€â”€â”€â–º DEFAULT TO QUIZ
â”‚                â”‚                     (Safe fallback)
â”‚                â”‚
â”‚                â”œâ”€ API OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GET eligibilities ARRAY
â”‚                                      â”‚
â”‚                                      â”œâ”€ LENGTH > 0
â”‚                                      â”‚  (Has records)
â”‚                                      â”‚
â”‚                                      â”‚  â””â”€â”€â–º SKIP QUIZ!
â”‚                                      â”‚       GO TO VOICE AGENT
â”‚                                      â”‚       â””â”€â”€â–º COMPLETE INTERVIEW
â”‚                                      â”‚           â””â”€â”€â–º DASHBOARD
â”‚                                      â”‚
â”‚                                      â””â”€ LENGTH = 0
â”‚                                         (No records)
â”‚                                         â”‚
â”‚                                         â””â”€â”€â–º SHOW QUIZ
â”‚                                             (6-step wizard)
â”‚                                             â””â”€â”€â–º VOICE AGENT
â”‚                                                 â””â”€â”€â–º DASHBOARD
```

## Time Comparison

### New User Flow
```
Home Page
  â”‚
  â”œâ”€ [Test Eligibility] button clicked
  â”‚
  â”œâ”€ Eligibility Quiz (6 steps) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ~5-10 minutes
  â”‚
  â”œâ”€ Voice Agent Interview (VAPI) â”€â”€â”€â”€â”€â”€â”€â”€ ~10-15 minutes
  â”‚
  â””â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ âœ… COMPLETE

Total Time: ~15-25 minutes
```

### Returning User Flow (NEW! âœ¨)
```
Home Page
  â”‚
  â”œâ”€ [Test Eligibility] button clicked
  â”‚
  â”œâ”€ API Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ~0.2 seconds
  â”‚   (Records found!)
  â”‚
  â”œâ”€ Voice Agent Interview (VAPI) â”€â”€â”€â”€â”€â”€â”€â”€ ~10-15 minutes
  â”‚
  â””â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ âœ… COMPLETE

Total Time: ~10-15 minutes
SAVED: ~5-10 minutes! âš¡
```

## API Call Details

```
REQUEST:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /auth/me                         â”‚
â”‚ Headers:                             â”‚
â”‚ - Authorization: Bearer {token}      â”‚
â”‚ - Content-Type: application/json     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESPONSE (Success):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                                        â”‚
â”‚   "user": {                                              â”‚
â”‚     "id": "user_id_123",                                â”‚
â”‚     "email": "user@example.com",                        â”‚
â”‚     "full_name": "John Doe",                           â”‚
â”‚     "phone": "+1234567890",                            â”‚
â”‚     "eligibilities": [                                  â”‚
â”‚       {                                                 â”‚
â”‚         "id": "elig_id_1",                             â”‚
â”‚         "summary": "Eligible for benefits",            â”‚
â”‚         "metadata": {...}                              â”‚
â”‚       }                                                 â”‚
â”‚     ],                                    â† KEY ARRAY! â”‚
â”‚     "verified": true,                                  â”‚
â”‚     "created_at": "2025-01-01T00:00:00Z",             â”‚
â”‚     "updated_at": "2025-12-21T10:30:00Z"              â”‚
â”‚   }                                                     â”‚
â”‚ }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESPONSE (Error):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP 401 Unauthorized                â”‚
â”‚ HTTP 500 Server Error                â”‚
â”‚ Network Error / Timeout              â”‚
â”‚                                      â”‚
â”‚ â†’ DEFAULT TO SHOWING QUIZ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Transitions

```
Initial State: showQuiz = false, otpState = "phone"

Step 1: User clicks "Test Eligibility"
        showQuiz = true
        (Modal opens)

Step 2: Check login status
        isLoggedIn = true?

Step 3: Fetch /auth/me
        isCheckingEligibility = true
        (Loading/disabled state)

Step 4: Parse response
        eligibilities = userData?.user?.eligibilities || []

Step 5: Decision
        â”œâ”€ eligibilities.length > 0?
        â”‚  YES â”€â”€â–º otpState = "ai-lawyer"
        â”‚
        â””â”€ NO â”€â”€â–º otpState = "wizard"

Step 6: UI Updates
        otpState = "ai-lawyer" â”€â”€â–º Show AILawyerWrapper
        otpState = "wizard" â”€â”€â”€â”€â–º Show EligibilityQuestionnaire

Step 7: Complete
        User completes interview
        router.push("/dashboard")
```

## Component Integration

```
page.tsx
  â”‚
  â”œâ”€ handleStartQuiz()
  â”‚   â”‚
  â”‚   â”œâ”€ Check localStorage token
  â”‚   â”‚
  â”‚   â”œâ”€ Fetch /auth/me
  â”‚   â”‚
  â”‚   â”œâ”€ Set otpState
  â”‚   â”‚
  â”‚   â””â”€ Return
  â”‚
  â”œâ”€ otpState = "wizard"
  â”‚   â”‚
  â”‚   â””â”€ Render <EligibilityQuestionnaire />
  â”‚       â””â”€ 6-step form
  â”‚           â””â”€ handleEligibilityComplete()
  â”‚               â””â”€ setOtpState("ai-lawyer")
  â”‚
  â”œâ”€ otpState = "ai-lawyer"
  â”‚   â”‚
  â”‚   â””â”€ Render <AILawyerWrapper />
  â”‚       â””â”€ <AILawyerInterface /> (VAPI)
  â”‚           â””â”€ handleAILawyerComplete()
  â”‚               â””â”€ router.push("/dashboard")
  â”‚
  â””â”€ otpState = "phone"
      â”‚
      â””â”€ Render Login/Signup Forms
```

## Error Recovery

```
API Error â”€â”€â–º Log to console â”€â”€â–º Set otpState = "wizard"
              â”‚                  â”‚
              â”‚                  â””â”€â”€â–º User sees quiz
              â”‚
              â””â”€â”€â–º Graceful fallback (no app crash)


Network Timeout â”€â”€â–º Catch block â”€â”€â–º Log error â”€â”€â–º Default to wizard
                    â”‚
                    â””â”€â”€â–º User continues normally


Invalid Token â”€â”€â–º API returns 401 â”€â”€â–º Check for token â”€â”€â–º Show login
                  â”‚
                  â””â”€â”€â–º User logs in again
```

---

This diagram shows the complete flow from "Test Eligibility" click through to Dashboard completion! ðŸŽ¯
